import{a as g}from"./chunk-HCFXBRVH.js";import{Ga as S,Ya as C,Yb as l,Zb as u,b,c as p,d as h,g as c,j as s,ya as d,z as a}from"./chunk-UWOWUE4S.js";import{e as v}from"./chunk-XD4PSF4R.js";var $=(()=>{let r=class r{constructor(){this.httpClient=s(d),this.apiEndPoint=`${l.apiUrl}/contracts`,this.alertService=s(u),this.contracts=a([]),this.currentContract=a({}),this.loadData()}loadData(){let t=this.httpClient.get(`${this.apiEndPoint}/list`).pipe(p(3),b(e=>(this.alertService.basicAlert("Error",`Ocurri\xF3 un error al conectarse al servidor: ${e.statusText}`,["Ok"]),[])),h(1)).subscribe(e=>{this.contracts.set(e.data),t.unsubscribe()})}setCurrentContract(t){this.currentContract.update(()=>t)}};r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var y=(()=>{let r=class r{constructor(){this.damages=a([])}addDamage(t){this.damages.update(e=>[...e,t])}};r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var x=(()=>{let r=class r{constructor(){this.httpClient=s(d),this.apiEndPoint=`${l.apiUrl}/cars`,this.alertService=s(u),this.cars=a([]),this.currentCar=a({}),this.loadData()}loadData(){let t=this.httpClient.get(`${this.apiEndPoint}/list`).pipe(p(3),h(1)).subscribe(e=>{this.cars.set(e.data),t.unsubscribe()})}};r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();var tt=(()=>{let r=class r{constructor(){this.httpClient=s(d),this.apiEndPoint=`${l.apiUrl}/inspections`,this.alertsService=s(u),this.contractsService=s($),this.damagesService=s(y),this.accessoriesService=s(g),this.carsService=s(x),this.navCtrl=s(C),this.router=s(S),this.inspections=a(void 0),this.currentInspection=a(void 0),this.loadData()}loadData(){let t=this.httpClient.get(`${this.apiEndPoint}/list`).pipe(p(3),b(e=>(this.alertsService.basicAlert("Error",`Ocurri\xF3 un error al conectarse al servidor: ${e.error.message}`,["Ok"]),[])),h(1)).subscribe(e=>{this.inspections.set(e.data),t.unsubscribe()})}updateCurrentInspection(t){this.currentInspection.update(()=>t)}createInspection(){return v(this,null,function*(){yield this.alertsService.presentLoading(),this.httpClient.post(`${this.apiEndPoint}/add`,this.currentInspection()).subscribe({next:t=>{this.alertsService.dismissDefaultLoading(),this.inspections.update(e=>[...e,t.data]),this.contractsService.contracts.update(e=>{let n=[...e],m=n.findIndex(f=>{var o;return f.idContrato==((o=this.currentInspection())==null?void 0:o.idContrato)});return n[m].inspection=t.data,n}),this.clearState(),this.router.navigate(["/home"]),this.alertsService.basicAlert("\xC9xito!",`Inspecci\xF3n ${t.data.numInspeccion} - guardada exitosamente. Veh\xEDculo: ${t.data.car.nemVehiculo} | Contrato No.: ${t.data.contract.numContrato}.`,["Ok"])},error:t=>{this.alertsService.dismissDefaultLoading(),this.alertsService.basicAlert("Error",`Ocurri\xF3 un error al conectarse al servidor: ${t.error.message}`,["Ok"])}})})}closeInspection(){return v(this,null,function*(){yield this.alertsService.presentLoading(),this.httpClient.post(`${this.apiEndPoint}/close`,this.currentInspection()).subscribe(t=>{this.alertsService.dismissDefaultLoading(),this.inspections.update(e=>{let n=[...e],m=n.findIndex(f=>{var o;return f.idInspeccion==((o=this.currentInspection())==null?void 0:o.idInspeccion)});return n[m]=t.data,n}),this.contractsService.contracts.update(e=>{let n=[...e],m=n.findIndex(f=>{var o;return f.idContrato==((o=this.currentInspection())==null?void 0:o.idContrato)});return n[m].inspection=t.data,n}),this.clearState(),this.router.navigate(["/home"]),this.alertsService.basicAlert("\xC9xito!",`Inspecci\xF3n ${t.data.numInspeccion} - cerrada exitosamente. Veh\xEDculo: ${t.data.car.nemVehiculo} | Contrato No.: ${t.data.contract.numContrato}.`,["Ok"])},t=>{this.alertsService.dismissDefaultLoading(),this.alertsService.basicAlert("Error",`Ocurri\xF3 un error al conectarse al servidor: ${t.error.message}`,["Ok"])})})}printInspection(t){return v(this,null,function*(){return this.httpClient.get(`${this.apiEndPoint}/print?idInspeccion=${t}`)})}clearState(){this.currentInspection.set(void 0),this.contractsService.currentContract.set({}),this.damagesService.damages.set([]),this.accessoriesService.currentAccessories.set([]),this.accessoriesService.loadData(),this.carsService.currentCar.set({})}};r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"});let i=r;return i})();export{$ as a,y as b,x as c,tt as d};
