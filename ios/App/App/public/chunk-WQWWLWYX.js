import{a as Qe}from"./chunk-EWZCINLZ.js";import{a as Je}from"./chunk-P4PRXZGJ.js";import{a as w}from"./chunk-5QU6NYYZ.js";import{a as Ue,b as He}from"./chunk-HUIOHKJA.js";import"./chunk-LEX6B2L3.js";import{a as y}from"./chunk-DTNKQRUS.js";import{a as V}from"./chunk-IKMMEWKZ.js";import"./chunk-OVKUN2VZ.js";import{a as Be,b as Ge,v as Ke}from"./chunk-7JYYFWPO.js";import"./chunk-56TNLAWK.js";import{a as ze,c as qe,d as We}from"./chunk-VPIOKAOU.js";import"./chunk-HCFXBRVH.js";import{A as E,B as F,C as M,Cb as ye,Db as we,E as g,G as k,Ga as ce,H as Z,I as $,J as ee,Jb as Pe,K as a,Ka as z,Kb as De,L as r,Lb as Fe,M as C,Ma as N,N as T,Nb as Me,Ob as Ne,P as S,Pb as Ae,Q as f,Qa as A,Sb as Le,Tb as Re,Ua as ae,Va as le,Wa as se,X as m,Xb as Oe,Y as R,Ya as ue,Z as O,Zb as je,_b as L,aa as te,ab as de,ba as ne,bb as me,ca as ie,cb as pe,fb as he,gb as _e,h as P,hb as Ce,ib as fe,j as I,jb as ge,k as Y,l as D,la as j,lb as Se,ma as oe,o as x,ob as ve,p as b,pb as Ie,qb as xe,rb as be,sb as Ee,tb as Te,ua as re,v as u,vb as q,yb as Ve,zb as ke}from"./chunk-UWOWUE4S.js";import"./chunk-BSN2JFBO.js";import"./chunk-ON2Z5523.js";import"./chunk-JNTQS7SG.js";import"./chunk-4PGTP63H.js";import"./chunk-HC6MZPB3.js";import"./chunk-QRDTLJMM.js";import"./chunk-SNYBEKMS.js";import"./chunk-5GDE5I7K.js";import"./chunk-CUAZPCFG.js";import"./chunk-KYGY6K7Z.js";import"./chunk-5AWJTBLE.js";import"./chunk-C4BIBDV4.js";import"./chunk-4537AK5U.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import"./chunk-2UEEUHXC.js";import"./chunk-MCRJI3T3.js";import"./chunk-FOZNFNPM.js";import"./chunk-G5HA7YTQ.js";import{a as v}from"./chunk-XD4PSF4R.js";var tt=()=>[N,A,y,Be],Ye=()=>[q,N,A,y];function nt(t,o){if(t&1){let c=T();C(0,"fa-icon",11),a(1,"ionic-selectable",12),S("onChange",function(n){x(c);let e=f(2);return b(e.selectContract(n))}),r()}if(t&2){let c=f(2);g("icon",c.contract),u(),g("ngModel",c.currentContract())("items",c.contracts)("canSearch",!0)}}function it(t,o){t&1&&(a(0,"span"),m(1,"Loading..."),r())}function ot(t,o){t&1&&(a(0,"ion-label"),m(1,"Obteniendo Datos.."),r(),C(2,"ion-spinner",13))}function rt(t,o){t&1&&(a(0,"span"),m(1,"Error"),r())}function ct(t,o){if(t&1){let c=T();C(0,"ion-icon",14),a(1,"ionic-selectable",15),S("onChange",function(n){x(c);let e=f(2);return b(e.selectCar(n))}),r()}if(t&2){let c=f(2);u(),g("ngModel",c.currentCar())("items",c.cars())("canSearch",!0)}}function at(t,o){t&1&&(a(0,"span"),m(1,"Loading..."),r())}function lt(t,o){t&1&&(a(0,"ion-label"),m(1,"Obteniendo Datos.."),r(),C(2,"ion-spinner",13))}function st(t,o){t&1&&(a(0,"span"),m(1,"Error"),r())}function ut(t,o){if(t&1&&(a(0,"ion-row")(1,"ion-col")(2,"ion-card",9)(3,"ion-item",10)(4,"ion-label"),m(5,"Seleccione un Contrato"),r(),E(6,nt,2,4)(7,it,2,0)(8,ot,3,0)(9,rt,2,0),F(10,6,tt,7,8,9),r()()()(),a(12,"ion-row")(13,"ion-col")(14,"ion-card",9)(15,"ion-item",10)(16,"ion-label"),m(17,"Seleccione un Veh\xEDculo"),r(),E(18,ct,2,3)(19,at,2,0)(20,lt,3,0)(21,st,2,0),F(22,18,Ye,19,20,21),r()()()()),t&2){let c=f();u(10),M(c.contracts.length>0),u(12),M(c.contracts.length>0)}}function dt(t,o){if(t&1){let c=T();C(0,"ion-icon",14),a(1,"ionic-selectable",15),S("onChange",function(n){x(c);let e=f(2);return b(e.selectCar(n))}),r()}if(t&2){let c=f(2);u(),g("ngModel",c.currentCar())("items",c.checkinCars())("canSearch",!0)}}function mt(t,o){t&1&&(a(0,"span"),m(1,"Loading..."),r())}function pt(t,o){t&1&&(a(0,"ion-label"),m(1,"Obteniendo Datos.."),r(),C(2,"ion-spinner",13))}function ht(t,o){t&1&&(a(0,"span"),m(1,"Error"),r())}function _t(t,o){if(t&1&&(a(0,"ion-row")(1,"ion-col")(2,"ion-card",9)(3,"ion-item",10)(4,"ion-label"),m(5,"Seleccione un Veh\xEDculo"),r(),E(6,dt,2,3)(7,mt,2,0)(8,pt,3,0)(9,ht,2,0),F(10,6,Ye,7,8,9),r()()()()),t&2){let c=f();u(10),M(c.checkinCars())}}function Ct(t,o){t&1&&(a(0,"ion-row",4)(1,"ion-col",3)(2,"span"),m(3,"A\xFAn no ha seleccionado un contrato..."),r()()())}function ft(t,o){if(t&1&&(a(0,"ion-select-option",24),m(1),r()),t&2){let c=o.$implicit;g("value",c.idTanqueComb),u(),O("",c.descTanqueComb," ")}}function gt(t,o){if(t&1){let c=T();a(0,"ion-card",9)(1,"ion-card-header")(2,"ion-list")(3,"ion-item",10)(4,"ion-card-title"),m(5,"Documento"),r(),a(6,"ion-icon",25),S("click",function(){x(c);let n=f(2);return b(n.removeDocument())}),r()()()(),a(7,"ion-card-content"),C(8,"ion-img-viewer",26),r()()}if(t&2){let c,i=f(2);u(8),g("src","data:image/png;base64,"+((c=i.currentInspection())==null?null:c.fotoLicencia))}}function St(t,o){if(t&1){let c=T();a(0,"ion-card",9)(1,"ion-list")(2,"ion-row")(3,"ion-col",3)(4,"ion-item"),C(5,"ion-input",16),r()(),a(6,"ion-col",3)(7,"ion-item"),C(8,"ion-input",17),r()()(),a(9,"ion-row")(10,"ion-col",3)(11,"ion-item"),C(12,"ion-input",18),r()(),a(13,"ion-col",3)(14,"ion-item"),C(15,"ion-input",19),r()()(),a(16,"ion-row")(17,"ion-col",20)(18,"ion-item",10)(19,"ion-label",21),m(20),r(),a(21,"ion-input",22),S("ionChange",function(n){x(c);let e=f();return b(e.setOdometer(n))}),r()()(),a(22,"ion-col",20)(23,"ion-item")(24,"ion-label",21),m(25),r(),a(26,"ion-select",23),ie("ngModelChange",function(n){x(c);let e=f();return ne(e.currentFuel,n)||(e.currentFuel=n),b(n)}),S("ionChange",function(n){x(c);let e=f();return b(e.setFuel(n))}),a(27,"ion-select-option",24),m(28,"Seleccione una opci\xF3n "),r(),$(29,ft,2,2,"ion-select-option",24,Z),r()()()()()(),E(31,gt,9,1,"ion-card",9)}if(t&2){let c,i,n,e,l,s,p,h,_,d=f();u(5),g("value",(c=d.currentContract().customer)==null?null:c.nomCliente),u(3),g("value",((i=d.currentContract().driver)==null?null:i.nomCliente)||"Sin Registro"),u(4),g("value",((n=d.currentCar().model)==null||n.brand==null?null:n.brand.descMarca)+" "+d.currentCar().modelo+" | "+d.currentCar().numMatricula),u(3),g("value",d.currentCar().color),u(5),R("*Kilometraje "+(((e=d.currentInspection())==null?null:e.stage)==="checkout"?"OUT":"IN")),u(),g("value",((l=d.currentInspection())==null?null:l.stage)==="checkout"?d.currentCar().odometro:null)("min",((s=d.currentInspection())==null?null:s.stage)==="checkout"?d.currentCar().odometro:((s=d.currentInspection())==null?null:s.odoSalida)+1)("max",((p=d.currentInspection())==null?null:p.stage)==="checkout"?d.currentCar().odometro+1e3:((p=d.currentInspection())==null?null:p.odoSalida)+999999999),u(4),R("*Nivel de Combustible "+(((h=d.currentInspection())==null?null:h.stage)==="checkout"?"OUT":"IN")),u(),te("ngModel",d.currentFuel),u(),g("value",null),u(2),ee(d.fuelTanks()),u(2),k(31,((_=d.currentInspection())==null?null:_.fotoLicencia)!==void 0&&((_=d.currentInspection())==null?null:_.stage)=="checkout"?31:-1)}}function vt(t,o){if(t&1){let c=T();a(0,"ion-fab",5)(1,"ion-fab-button",7),S("click",function(){x(c);let n=f();return b(n.addDocument())}),C(2,"ion-icon",27),r()()}}var Ze=(()=>{let o=class o{constructor(){var i,n,e;this.contractsService=I(ze),this.inspectionsServices=I(We),this.alertsService=I(je),this.photoService=I(Qe),this.fuelTanksService=I(Je),this.carsService=I(qe),this.navCtlr=I(ue),this.router=I(ce),this.title="",this.contracts=[],this.currentInspection=this.inspectionsServices.currentInspection,this.currentContract=this.contractsService.currentContract,this.currentCar=this.carsService.currentCar,this.cars=j(()=>this.carsService.cars().filter(l=>{var p;let s=(p=this.inspectionsServices.inspections())==null?void 0:p.filter(h=>h.idEstado==48).map(h=>{var _;return(_=h.car)==null?void 0:_.idVehiculo});return!(s!=null&&s.includes(l.idVehiculo))})),this.checkinCars=j(()=>{var l;return(l=this.inspectionsServices.inspections())==null?void 0:l.filter(s=>s.idEstado==48).map(s=>s.car)}),this.fuelTanks=this.fuelTanksService.fuelTanks,this.contract=Ke,this.currentFuel=null,this.currentStage=(e=(n=(i=this.router.getCurrentNavigation())==null?void 0:i.extras)==null?void 0:n.state)==null?void 0:e.stage,this.title=this.currentStage=="checkin"?" Checkin":" Checkout",oe(()=>{this.currentStage=="checkin"?this.contracts=this.contractsService.contracts().filter(l=>{var s;return((s=l.inspection)==null?void 0:s.idEstado)==48}):this.contracts=this.contractsService.contracts()})}ngOnDestroy(){this.currentInspection.set(void 0)}selectContract(i){var e,l,s;let n;if(this.currentStage=="checkin"){let h=((e=this.inspectionsServices.inspections())==null?void 0:e.filter(_=>_.idEstado==48)).find(_=>_.idVehiculo==i.value.idVehiculo);n=(l=this.contractsService.contracts())==null?void 0:l.find(_=>_.idContrato==(h==null?void 0:h.idContrato)),this.contractsService.setCurrentContract(n),this.initializeCheckin(h)}else n=(s=this.contractsService.contracts())==null?void 0:s.find(p=>p.idContrato==i.value.idContrato),this.contractsService.setCurrentContract(n),this.initializeCheckout()}selectCar(i){var e,l,s;let n=(e=this.carsService.cars())==null?void 0:e.find(p=>p.idVehiculo==i.value.idVehiculo);this.carsService.currentCar.set(n),((l=this.currentInspection())==null?void 0:l.stage)=="checkin"?this.selectContract(i):((s=this.currentInspection())==null?void 0:s.stage)=="checkout"&&this.inspectionsServices.currentInspection.update(p=>{let h=v({},p);return h.idVehiculo=this.carsService.currentCar().idVehiculo,h.odoSalida=this.carsService.currentCar().odometro,h.combSalida=void 0,h}),this.currentFuel=null}initializeCheckin(i){this.currentFuel=null,this.inspectionsServices.currentInspection.set(i),this.inspectionsServices.currentInspection.update(n=>{let e=v({},n);return e.stage=this.currentStage,e.odoEntrega=void 0,e.combEntrega=void 0,e.accesoriosEntrega=[],e}),this.contractsService.currentContract.update(n=>{var l;let e=v({},n);return e.car&&(e.car.odometro=(l=this.currentInspection())==null?void 0:l.odoSalida),e})}initializeCheckout(){var i;this.currentFuel=(i=this.currentContract().check_out_fuel)==null?void 0:i.idTanqueComb,this.inspectionsServices.currentInspection.update(n=>{var l,s;let e=v({},n);return e.stage=this.currentStage,e.idVehiculo=this.contractsService.currentContract().idVehiculo,e.idContrato=this.contractsService.currentContract().idContrato,e.idCliente=this.contractsService.currentContract().idCliente,e.idAgenciaSalida=this.contractsService.currentContract().idAgenciaSalida,e.fechaSalida=this.contractsService.currentContract().fechaSalida,e.odoSalida=(l=this.contractsService.currentContract().car)==null?void 0:l.odometro,e.nomRecibeVehiculo=(s=this.contractsService.currentContract().customer)==null?void 0:s.nomCliente,e.accesoriosSalida=[],e.photos=[],e.combSalida=this.currentFuel,e}),this.carsService.currentCar.set(this.currentContract().car)}goToNext(){var p,h,_,d,W,B,G,K,U,H,J,Q,X;let i,n,e,l,s;if(((p=this.currentInspection())==null?void 0:p.stage)=="checkin"?(i=((h=this.currentInspection())==null?void 0:h.idVehiculo)!=null,n=((_=this.currentInspection())==null?void 0:_.combEntrega)!=null,e=((d=this.currentInspection())==null?void 0:d.odoEntrega)!=null,l=((W=this.currentInspection())==null?void 0:W.odoEntrega)>((B=this.currentInspection())==null?void 0:B.odoSalida),s=(G=this.currentInspection())==null?void 0:G.odoSalida):(i=((K=this.currentInspection())==null?void 0:K.idVehiculo)!=null,n=((U=this.currentInspection())==null?void 0:U.combSalida)!=null&&((H=this.currentInspection())==null?void 0:H.combSalida)!=null,e=((J=this.currentInspection())==null?void 0:J.odoSalida)!=null&&((Q=this.currentInspection())==null?void 0:Q.odoSalida)!=null,l=((X=this.currentInspection())==null?void 0:X.odoSalida)<=this.carsService.currentCar().odometro+1e3,s=this.carsService.currentCar().odometro),i&&n&&e&&l)this.navCtlr.navigateForward(["/inspections/create/photos"],{state:{customer:this.currentContract().customer,driver:this.currentContract().driver}});else{let et=i?l?"No ha completado la informaci\xF3n":`El Kilometraje ingresado no es v\xE1lido. El valor de referencia es ${s}`:"No ha seleccionado un veh\xEDculo";this.alertsService.basicAlert("Atenci\xF3n!",et,["Ok"])}}setOdometer(i){this.inspectionsServices.currentInspection.update(n=>{let e=v({},n);return e.stage=="checkin"?e.odoEntrega=parseInt(i.target.value):e.odoSalida=parseInt(i.target.value),e})}setFuel(i){this.inspectionsServices.currentInspection.update(n=>{let e=v({},n);return e.stage=="checkin"?e.combEntrega=i.target.value.toString().trim():e.combSalida=i.target.value.toString().trim(),e})}addDocument(){this.photoService.addNewToGallery().then(()=>{this.inspectionsServices.currentInspection.update(i=>{let n=v({},i);return n.fotoLicencia=this.photoService.photos()[0],n}),this.photoService.clearPhotos()})}removeDocument(){this.inspectionsServices.currentInspection.update(i=>{let n=v({},i);return n.fotoLicencia=void 0,n})}handleRefresh(i){this.contractsService.loadData(),this.carsService.loadData(),this.fuelTanksService.loadData(),i.target.complete()}};o.\u0275fac=function(n){return new(n||o)},o.\u0275cmp=Y({type:o,selectors:[["app-inspection-create"]],decls:20,vars:5,consts:[[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],["fixed",""],["size","12"],[1,"ion-align-items-center"],["vertical","bottom","horizontal","start","slot","fixed"],["slot","end"],[3,"click"],["slot","end","name","arrow-forward"],[2,"border-radius","10px"],["lines","none"],["color","secondary","slot","start",2,"color","var(--ion-color-secondary)",3,"icon"],["color","secondary","itemValueField","idContrato","itemTextField","numContrato",1,"ion-margin-start",3,"onChange","ngModel","items","canSearch"],["color","secondary","name","crescent"],["color","secondary","slot","start","name","car"],["color","secondary","itemValueField","idVehiculo","itemTextField","nemVehiculo",1,"ion-margin-start",3,"onChange","ngModel","items","canSearch"],["color","secondary","labelPlacement","stacked","label","Nombre del Cliente","type","text","readonly","",3,"value"],["color","secondary","labelPlacement","stacked","label","Conductor Adicional","type","text","readonly","",3,"value"],["color","secondary","labelPlacement","stacked","label","Marca y Modelo del Veh\xEDculo | Placa","type","text","placeholder","Marca y Modelo del Veh\xEDculo | Placa","readonly","",3,"value"],["color","secondary","labelPlacement","stacked","label","Color","type","text","placeholder","Color","readonly","",3,"value"],["size","6"],["position","stacked",2,"--color","var(--ion-color-secondary)"],["required","","type","number","errorText","Valor no v\xE1lido","aria-label","Kilometraje",3,"ionChange","value","min","max"],["required","","type","text","errorText","Este campo es obligatorio","aria-label","Nivel de Combustible",3,"ngModelChange","ionChange","ngModel","label"],[3,"value"],["button","","color","danger","name","close-circle","slot","end",3,"click"],["title","Licencia","text","Preview","scheme","light",3,"src"],["name","document-attach"]],template:function(n,e){if(n&1&&(C(0,"app-toolbar"),a(1,"ion-content",0)(2,"ion-refresher",1),S("ionRefresh",function(s){return e.handleRefresh(s)}),C(3,"ion-refresher-content"),r(),a(4,"ion-grid",2)(5,"ion-row")(6,"ion-col",3)(7,"ion-title"),m(8),r()()(),E(9,ut,24,2)(10,_t,12,1)(11,Ct,4,0,"ion-row",4)(12,St,32,12),r(),E(13,vt,3,0,"ion-fab",5),r(),a(14,"ion-footer")(15,"ion-toolbar")(16,"ion-buttons",6)(17,"ion-button",7),S("click",function(){return e.goToNext()}),m(18," Siguiente "),C(19,"ion-icon",8),r()()()()),n&2){let l,s,p;u(),g("fullscreen",!0),u(7),O("Nueva Inspecci\xF3n de ",e.currentStage==="checkout"?"Salida":"Entrada"," "),u(),k(9,((l=e.currentInspection())==null?null:l.stage)==="checkout"?9:((l=e.currentInspection())==null?null:l.stage)=="checkin"?10:-1),u(2),k(11,((s=e.currentInspection())==null?null:s.idVehiculo)===void 0?11:12),u(2),k(13,((p=e.currentInspection())==null?null:p.idVehiculo)!==void 0&&e.currentStage==="checkout"?13:-1)}},dependencies:[he,_e,Ce,fe,ge,Se,ve,Ie,xe,be,Ee,Te,q,Ve,ke,ye,we,Pe,De,Fe,Me,Ne,Ae,Le,Re,de,me,pe,N,ae,A,L,Ue]});let t=o;return t})();var It=[{path:"",component:Ze,canActivate:[V]},{path:"photos",loadComponent:()=>import("./chunk-TXDVJV7A.js").then(t=>t.PhotosComponent),canActivate:[V,w]},{path:"accessories",loadComponent:()=>import("./chunk-Z7DRBME3.js").then(t=>t.AccessoriesComponent),canActivate:[V,w]},{path:"notes",loadComponent:()=>import("./chunk-AHIPGVC5.js").then(t=>t.AdditionalNotesComponent),canActivate:[V,w]},{path:"signing",loadComponent:()=>import("./chunk-NV5LIVIZ.js").then(t=>t.SigningComponent),canActivate:[V,w]}],$e=(()=>{let o=class o{};o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=D({type:o}),o.\u0275inj=P({imports:[z.forChild(It),z]});let t=o;return t})();var nn=(()=>{let o=class o{};o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=D({type:o}),o.\u0275inj=P({imports:[Oe,re,$e,se,le,y,L,Ge,He]});let t=o;return t})();export{nn as InspectionCreatePageModule};
