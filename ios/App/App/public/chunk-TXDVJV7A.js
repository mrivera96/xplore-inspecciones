import{a as be}from"./chunk-TO77FLXM.js";import{a as R}from"./chunk-EWZCINLZ.js";import{a as Ee}from"./chunk-WUM67DLH.js";import{a as O,b as $}from"./chunk-HUIOHKJA.js";import"./chunk-LEX6B2L3.js";import"./chunk-56TNLAWK.js";import{b as we,d as B}from"./chunk-VPIOKAOU.js";import"./chunk-HCFXBRVH.js";import{A as S,B as K,C as Q,Cb as Ce,Db as ve,E as u,G as k,Ga as te,H as P,I as T,J as y,K as c,L as a,Lb as z,M as _,Ma as oe,N as w,Nb as Ie,Ob as xe,P as f,Pb as Se,Q as p,Qa as ie,Sb as Pe,Tb as Te,Ua as ne,Va as re,X as h,Xb as N,Y as v,Ya as ae,Yb as ye,Zb as A,_b as De,aa as X,ba as Y,bb as ce,ca as Z,ea as F,fb as W,gb as se,hb as le,ib as pe,j as m,jb as me,k as E,lb as de,ma as ee,nb as he,o as g,ob as V,p as C,pb as ue,qb as _e,r as J,rb as fe,sb as ge,tb as M,v as s,vb as D,zb as b}from"./chunk-UWOWUE4S.js";import"./chunk-BSN2JFBO.js";import"./chunk-ON2Z5523.js";import"./chunk-JNTQS7SG.js";import"./chunk-4PGTP63H.js";import"./chunk-HC6MZPB3.js";import"./chunk-QRDTLJMM.js";import"./chunk-SNYBEKMS.js";import"./chunk-5GDE5I7K.js";import"./chunk-CUAZPCFG.js";import"./chunk-KYGY6K7Z.js";import"./chunk-5AWJTBLE.js";import"./chunk-C4BIBDV4.js";import"./chunk-4537AK5U.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import"./chunk-2UEEUHXC.js";import"./chunk-MCRJI3T3.js";import"./chunk-FOZNFNPM.js";import"./chunk-G5HA7YTQ.js";import{a as x,e as U}from"./chunk-XD4PSF4R.js";function Ne(t,r){if(t&1&&(c(0,"ion-select-option",3),h(1),a()),t&2){let e=r.$implicit;u("value",e.idTipoDanio),s(),v(e.descTipoDanio)}}var ke=(()=>{let r=class r{constructor(){this.photoService=m(R),this.damageTypesService=m(Ee),this.alertService=m(A),this.inspectionsService=m(B),this.damageTypes=this.damageTypesService.damageTypes,this.damage={},this.photo={},this.photoEvent=new J}ngOnInit(){}addDamage(){var n;this.damage.idTipoDanio!=null?(this.damage.damage_type=(n=this.damageTypes())==null?void 0:n.find(o=>o.idTipoDanio==this.damage.idTipoDanio),this.damage.damage_part=this.photo.auto_part,this.photoService.clearPhotos(),this.photo.damage=this.damage,this.inspectionsService.currentInspection.update(o=>{var l;let i=x({},o);return(l=i.photos)==null||l.push(this.photo),i}),this.photoEvent.emit({})):this.alertService.basicAlert("Atenci\xF3n!","Debe seleccionar un tipo de da\xF1o",["Ok"])}};r.\u0275fac=function(o){return new(o||r)},r.\u0275cmp=E({type:r,selectors:[["app-photo-damage"]],inputs:{photo:"photo"},outputs:{photoEvent:"photoEvent"},standalone:!0,features:[F],decls:15,vars:4,consts:[["size","12"],["lines","none"],["required","","label","Tipo de da\xF1o","labelPlacement","sticked","value","null","required","","placeholder","Seleccione un tipo",3,"ngModelChange","ngModel"],[3,"value"],["text","Preview","scheme","light",3,"title","src"],["vertical","bottom","horizontal","end","slot","fixed",2,"margin-bottom","60px"],[3,"click"],["name","checkmark"]],template:function(o,i){o&1&&(c(0,"ion-grid")(1,"ion-row")(2,"ion-col",0)(3,"ion-item",1)(4,"ion-select",2),Z("ngModelChange",function(d){return Y(i.damage.idTipoDanio,d)||(i.damage.idTipoDanio=d),d}),c(5,"ion-select-option",3),h(6,"Seleccione un tipo"),a(),T(7,Ne,2,2,"ion-select-option",3,P),a()()()(),c(9,"ion-row")(10,"ion-col"),_(11,"ion-img-viewer",4),a()()(),c(12,"ion-fab",5)(13,"ion-fab-button",6),f("click",function(){return i.addDamage()}),_(14,"ion-icon",7),a()()),o&2&&(s(4),X("ngModel",i.damage.idTipoDanio),s(),u("value",null),s(2),y(i.damageTypes()),s(4),u("title",i.photo.auto_part==null?null:i.photo.auto_part.descPieza)("src","data:image/png;base64,"+i.photo.foto))},dependencies:[N,V,_e,fe,M,D,b,z,Ie,xe,ce,re,oe,ne,ie,$,O]});let t=r;return t})();var Ae=()=>[W,le,pe,me,de,he,D,b,ve,O];function Be(t,r){if(t&1){let e=w();c(0,"ion-content",0)(1,"app-photo-damage",1),f("photoEvent",function(o){g(e);let i=p();return C(i.onDamageAdd(o))}),a()()}if(t&2){let e=p();u("fullscreen",!0),s(),u("photo",e.photo)}}function Oe(t,r){if(t&1){let e=w();c(0,"ion-card-header")(1,"ion-list")(2,"ion-item"),h(3),a(),c(4,"ion-item",10)(5,"ion-icon",15),f("click",function(){g(e);let o=p(2).$implicit,i=p(4);return C(i.removePhoto(o.foto))}),a()()()()}if(t&2){let e=p(2).$implicit;s(3),v(e.damage==null||e.damage.damage_type==null?null:e.damage.damage_type.descTipoDanio)}}function $e(t,r){if(t&1&&(c(0,"ion-card"),S(1,Oe,6,1,"ion-card-header"),c(2,"ion-card-content"),_(3,"ion-img-viewer",14),a()()),t&2){let e=p().$implicit,n=p(4);s(),k(1,e.foto.length>100?1:-1),s(2),u("title",e.auto_part==null?null:e.auto_part.descPieza)("text",e.foto.length>100?e.damage==null||e.damage.damage_type==null?null:e.damage.damage_type.descTipoDanio:"Preview")("src",e.foto.length>100?"data:image/png;base64,"+e.foto:n.photosDirectory+e.foto)}}function Re(t,r){if(t&1&&S(0,$e,4,4,"ion-card"),t&2){let e=r.$implicit,n=p().$implicit;k(0,e.idPieza==n.idPieza?0:-1)}}function We(t,r){if(t&1){let e=w();c(0,"ion-card",9)(1,"ion-card-header")(2,"ion-list")(3,"ion-item",10)(4,"ion-card-title"),h(5),a(),c(6,"ion-chip",11),h(7),a(),c(8,"ion-button",12),f("click",function(){let o=g(e).$implicit,i=p(3);return C(i.addPhoto(o))}),_(9,"ion-icon",13),a()()()(),c(10,"ion-card-content"),T(11,Re,1,1,null,null,P),a()()}if(t&2){let e,n=r.$implicit,o=p(3);s(5),v(n.descPieza),s(),u("color",n.count>0?"secondary":"default"),s(),v(n.count),s(4),y((e=o.currentInspection())==null?null:e.photos)}}function qe(t,r){if(t&1&&T(0,We,13,3,"ion-card",9,P),t&2){let e=p(2);y(e.autoParts())}}function Ge(t,r){t&1&&(c(0,"ion-item")(1,"ion-label"),h(2,"Obteniendo datos.."),a(),_(3,"ion-spinner",16),a())}function Le(t,r){if(t&1){let e=w();c(0,"ion-content",0)(1,"ion-grid",2)(2,"ion-row")(3,"ion-col",3)(4,"ion-title"),h(5,"Fotograf\xEDas"),a()()(),S(6,qe,2,0)(7,Ge,4,0),K(8,6,Ae,null,7),a()(),c(10,"ion-footer")(11,"ion-toolbar")(12,"ion-buttons",4)(13,"ion-button",5),f("click",function(){g(e);let o=p();return C(o.goToPrev())}),h(14," Atr\xE1s "),_(15,"ion-icon",6),a()(),c(16,"ion-buttons",7)(17,"ion-button",5),f("click",function(){g(e);let o=p();return C(o.goToNext())}),h(18," Siguiente "),_(19,"ion-icon",8),a()()()()}if(t&2){let e=p();u("fullscreen",!0),s(8),Q(e.autoParts().length>0)}}var Ct=(()=>{let r=class r{constructor(){var n,o,i,l,d,I,q;this.photoService=m(R),this.damagesService=m(we),this.autoPartsService=m(be),this.alertsService=m(A),this.inspectionsService=m(B),this.navCtrl=m(ae),this.router=m(te),this.title="",this.autoParts=this.autoPartsService.autoParts,this.photo={},this.photosDirectory=ye.imagesUrl,this.currentInspection=this.inspectionsService.currentInspection,this.title=((n=this.inspectionsService.currentInspection())==null?void 0:n.stage)=="checkin"?" Checkin":" Checkout",ee(()=>{var G;(G=this.autoParts())==null||G.forEach(L=>{var j,H;L.count=(H=(j=this.currentInspection())==null?void 0:j.photos)==null?void 0:H.filter(Fe=>L.idPieza==Fe.idPieza).length}),this.photo={}}),this.customer=(l=(i=(o=this.router.getCurrentNavigation())==null?void 0:o.extras)==null?void 0:i.state)==null?void 0:l.customer,this.driver=(q=(I=(d=this.router.getCurrentNavigation())==null?void 0:d.extras)==null?void 0:I.state)==null?void 0:q.driver}ngOnInit(){}ngOnDestroy(){}goToNext(){this.navCtrl.navigateForward(["/inspections/create/accessories"],{state:{customer:this.customer,driver:this.driver}})}goToPrev(){this.navCtrl.back()}removePhoto(n){this.inspectionsService.currentInspection.update(o=>{var l;let i=x({},o);return i.photos=(l=i.photos)==null?void 0:l.filter(d=>d.foto!=n),i})}addPhoto(n){return U(this,null,function*(){var o,i;yield this.photoService.addNewToGallery(),this.photo.foto=this.photoService.photos()[0],this.photo.auto_part=n,this.photo.idPieza=n.idPieza,this.photo.etapa=(o=this.currentInspection())==null?void 0:o.stage,((i=this.currentInspection())==null?void 0:i.stage)==="checkout"&&(this.photoService.clearPhotos(),this.inspectionsService.currentInspection.update(l=>{var I;let d=x({},l);return(I=d.photos)==null||I.push(this.photo),d}),this.photo={})})}onDamageAdd(n){this.photo=n}};r.\u0275fac=function(o){return new(o||r)},r.\u0275cmp=E({type:r,selectors:[["app-photos"]],standalone:!0,features:[F],decls:3,vars:1,consts:[[3,"fullscreen"],[3,"photoEvent","photo"],["fixed",""],["size","12"],["slot","start"],[3,"click"],["slot","start","name","arrow-back"],["slot","end"],["slot","end","name","arrow-forward"],[2,"border-radius","10px"],["lines","none"],["slot","end",3,"color"],["slot","end","expand","block","fill","clear","shape","round",3,"click"],["slot","end","name","camera"],["scheme","light",3,"title","text","src"],["button","","color","danger","name","close-circle","slot","end",3,"click"],["color","secondary","name","crescent"]],template:function(o,i){if(o&1&&(_(0,"app-toolbar"),S(1,Be,2,2,"ion-content",0)(2,Le,20,2)),o&2){let l;s(),k(1,i.photoService.photos().length>0&&((l=i.currentInspection())==null?null:l.stage)==="checkin"?1:2)}},dependencies:[N,W,se,V,ue,ge,M,D,b,Ce,z,Se,Pe,Te,De,$,ke]});let t=r;return t})();export{Ct as PhotosComponent};
