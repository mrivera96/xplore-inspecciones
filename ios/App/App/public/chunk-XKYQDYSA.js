import{a as He}from"./chunk-EWZCINLZ.js";import{a as Ue}from"./chunk-P4PRXZGJ.js";import{a as w}from"./chunk-TEATCKVU.js";import{a as Ge,b as Ke}from"./chunk-HUIOHKJA.js";import"./chunk-LEX6B2L3.js";import{a as y}from"./chunk-DTNKQRUS.js";import{a as V}from"./chunk-IKMMEWKZ.js";import"./chunk-OVKUN2VZ.js";import{a as Re,b as We,v as Be}from"./chunk-7JYYFWPO.js";import"./chunk-56TNLAWK.js";import{a as je,c as ze,d as qe}from"./chunk-3Z42Z5P2.js";import"./chunk-HCFXBRVH.js";import{A as E,B as F,C as M,Cb as ye,Db as we,E as g,G as k,Ga as ce,H as Z,I as $,J as ee,K as l,Ka as q,L as r,Lb as Pe,M as f,Ma as N,N as T,Nb as De,Ob as Fe,P as b,Pb as Me,Q as C,Qa as A,Sb as Ne,Tb as Ae,Ua as ae,Va as le,Wa as se,X as m,Xb as Le,Y as O,Ya as ue,Z as j,Zb as Oe,_b as L,aa as te,ab as de,ba as ne,bb as me,ca as ie,cb as pe,fb as he,gb as _e,h as P,hb as Ce,ib as fe,j as v,jb as ge,k as Y,l as D,la as z,lb as Se,ma as oe,o as I,ob as ve,p as x,pb as Ie,qb as xe,rb as be,sb as Ee,tb as Te,ua as re,v as u,vb as R,yb as Ve,zb as ke}from"./chunk-UWOWUE4S.js";import"./chunk-BSN2JFBO.js";import"./chunk-ON2Z5523.js";import"./chunk-JNTQS7SG.js";import"./chunk-4PGTP63H.js";import"./chunk-HC6MZPB3.js";import"./chunk-QRDTLJMM.js";import"./chunk-SNYBEKMS.js";import"./chunk-5GDE5I7K.js";import"./chunk-CUAZPCFG.js";import"./chunk-KYGY6K7Z.js";import"./chunk-5AWJTBLE.js";import"./chunk-C4BIBDV4.js";import"./chunk-4537AK5U.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import"./chunk-2UEEUHXC.js";import"./chunk-MCRJI3T3.js";import"./chunk-FOZNFNPM.js";import"./chunk-G5HA7YTQ.js";import{a as S}from"./chunk-XD4PSF4R.js";var $e=()=>[N,A,y,Re],Qe=()=>[R,N,A,y];function et(t,o){if(t&1){let c=T();f(0,"fa-icon",10),l(1,"ionic-selectable",11),b("onChange",function(n){I(c);let e=C(2);return x(e.selectContract(n))}),r()}if(t&2){let c=C(2);g("icon",c.contract),u(),g("ngModel",c.currentContract())("items",c.contracts)("canSearch",!0)}}function tt(t,o){t&1&&(l(0,"span"),m(1,"Loading..."),r())}function nt(t,o){t&1&&(l(0,"ion-label"),m(1,"Obteniendo Datos.."),r(),f(2,"ion-spinner",12))}function it(t,o){t&1&&(l(0,"span"),m(1,"Error"),r())}function ot(t,o){if(t&1){let c=T();f(0,"ion-icon",13),l(1,"ionic-selectable",14),b("onChange",function(n){I(c);let e=C(2);return x(e.selectCar(n))}),r()}if(t&2){let c=C(2);u(),g("ngModel",c.currentCar())("items",c.cars())("canSearch",!0)}}function rt(t,o){t&1&&(l(0,"span"),m(1,"Loading..."),r())}function ct(t,o){t&1&&(l(0,"ion-label"),m(1,"Obteniendo Datos.."),r(),f(2,"ion-spinner",12))}function at(t,o){t&1&&(l(0,"span"),m(1,"Error"),r())}function lt(t,o){if(t&1&&(l(0,"ion-row")(1,"ion-col")(2,"ion-card",8)(3,"ion-item",9)(4,"ion-label"),m(5,"Seleccione un Contrato"),r(),E(6,et,2,4)(7,tt,2,0)(8,nt,3,0)(9,it,2,0),F(10,6,$e,7,8,9),r()()()(),l(12,"ion-row")(13,"ion-col")(14,"ion-card",8)(15,"ion-item",9)(16,"ion-label"),m(17,"Seleccione un Veh\xEDculo"),r(),E(18,ot,2,3)(19,rt,2,0)(20,ct,3,0)(21,at,2,0),F(22,18,Qe,19,20,21),r()()()()),t&2){let c=C();u(10),M(c.contracts.length>0),u(12),M(c.contracts.length>0)}}function st(t,o){if(t&1){let c=T();f(0,"ion-icon",13),l(1,"ionic-selectable",14),b("onChange",function(n){I(c);let e=C(2);return x(e.selectCar(n))}),r()}if(t&2){let c=C(2);u(),g("ngModel",c.currentCar())("items",c.checkinCars())("canSearch",!0)}}function ut(t,o){t&1&&(l(0,"span"),m(1,"Loading..."),r())}function dt(t,o){t&1&&(l(0,"ion-label"),m(1,"Obteniendo Datos.."),r(),f(2,"ion-spinner",12))}function mt(t,o){t&1&&(l(0,"span"),m(1,"Error"),r())}function pt(t,o){if(t&1&&(l(0,"ion-row")(1,"ion-col")(2,"ion-card",8)(3,"ion-item",9)(4,"ion-label"),m(5,"Seleccione un Veh\xEDculo"),r(),E(6,st,2,3)(7,ut,2,0)(8,dt,3,0)(9,mt,2,0),F(10,6,Qe,7,8,9),r()()()()),t&2){let c=C();u(10),M(c.checkinCars())}}function ht(t,o){t&1&&(l(0,"ion-row",3)(1,"ion-col",2)(2,"span"),m(3,"A\xFAn no ha seleccionado un contrato..."),r()()())}function _t(t,o){if(t&1&&(l(0,"ion-select-option",23),m(1),r()),t&2){let c=o.$implicit;g("value",c.idTanqueComb),u(),j("",c.descTanqueComb," ")}}function Ct(t,o){if(t&1){let c=T();l(0,"ion-card",8)(1,"ion-card-header")(2,"ion-list")(3,"ion-item",9)(4,"ion-card-title"),m(5,"Documento"),r(),l(6,"ion-icon",24),b("click",function(){I(c);let n=C(2);return x(n.removeDocument())}),r()()()(),l(7,"ion-card-content"),f(8,"ion-img-viewer",25),r()()}if(t&2){let c,i=C(2);u(8),g("src","data:image/png;base64,"+((c=i.currentInspection())==null?null:c.fotoLicencia))}}function ft(t,o){if(t&1){let c=T();l(0,"ion-card",8)(1,"ion-list")(2,"ion-row")(3,"ion-col",2)(4,"ion-item"),f(5,"ion-input",15),r()(),l(6,"ion-col",2)(7,"ion-item"),f(8,"ion-input",16),r()()(),l(9,"ion-row")(10,"ion-col",2)(11,"ion-item"),f(12,"ion-input",17),r()(),l(13,"ion-col",2)(14,"ion-item"),f(15,"ion-input",18),r()()(),l(16,"ion-row")(17,"ion-col",19)(18,"ion-item",9)(19,"ion-label",20),m(20),r(),l(21,"ion-input",21),b("ionChange",function(n){I(c);let e=C();return x(e.setOdometer(n))}),r()()(),l(22,"ion-col",19)(23,"ion-item")(24,"ion-label",20),m(25),r(),l(26,"ion-select",22),ie("ngModelChange",function(n){I(c);let e=C();return ne(e.currentFuel,n)||(e.currentFuel=n),x(n)}),b("ionChange",function(n){I(c);let e=C();return x(e.setFuel(n))}),l(27,"ion-select-option",23),m(28,"Seleccione una opci\xF3n "),r(),$(29,_t,2,2,"ion-select-option",23,Z),r()()()()()(),E(31,Ct,9,1,"ion-card",8)}if(t&2){let c,i,n,e,a,s,p,h,_,d=C();u(5),g("value",(c=d.currentContract().customer)==null?null:c.nomCliente),u(3),g("value",((i=d.currentContract().driver)==null?null:i.nomCliente)||"Sin Registro"),u(4),g("value",((n=d.currentCar().model)==null||n.brand==null?null:n.brand.descMarca)+" "+d.currentCar().modelo+" | "+d.currentCar().numMatricula),u(3),g("value",d.currentCar().color),u(5),O("*Kilometraje "+(((e=d.currentInspection())==null?null:e.stage)==="checkout"?"OUT":"IN")),u(),g("value",((a=d.currentInspection())==null?null:a.stage)==="checkout"?d.currentCar().odometro:null)("min",((s=d.currentInspection())==null?null:s.stage)==="checkout"?d.currentCar().odometro:((s=d.currentInspection())==null?null:s.odoSalida)+1)("max",((p=d.currentInspection())==null?null:p.stage)==="checkout"?d.currentCar().odometro+1e3:((p=d.currentInspection())==null?null:p.odoSalida)+999999999),u(4),O("*Nivel de Combustible "+(((h=d.currentInspection())==null?null:h.stage)==="checkout"?"OUT":"IN")),u(),te("ngModel",d.currentFuel),u(),g("value",null),u(2),ee(d.fuelTanks()),u(2),k(31,((_=d.currentInspection())==null?null:_.fotoLicencia)!==void 0&&((_=d.currentInspection())==null?null:_.stage)=="checkout"?31:-1)}}function gt(t,o){if(t&1){let c=T();l(0,"ion-fab",4)(1,"ion-fab-button",6),b("click",function(){I(c);let n=C();return x(n.addDocument())}),f(2,"ion-icon",26),r()()}}var Xe=(()=>{let o=class o{constructor(){var i,n,e;this.contractsService=v(je),this.inspectionsServices=v(qe),this.alertsService=v(Oe),this.photoService=v(He),this.fuelTanksService=v(Ue),this.carsService=v(ze),this.navCtlr=v(ue),this.router=v(ce),this.title="",this.contracts=[],this.currentInspection=this.inspectionsServices.currentInspection,this.currentContract=this.contractsService.currentContract,this.currentCar=this.carsService.currentCar,this.cars=z(()=>this.carsService.cars().filter(a=>{var p;let s=(p=this.inspectionsServices.inspections())==null?void 0:p.filter(h=>h.idEstado==48).map(h=>{var _;return(_=h.car)==null?void 0:_.idVehiculo});return!(s!=null&&s.includes(a.idVehiculo))})),this.checkinCars=z(()=>{var a;return(a=this.inspectionsServices.inspections())==null?void 0:a.filter(s=>s.idEstado==48).map(s=>s.car)}),this.fuelTanks=this.fuelTanksService.fuelTanks,this.contract=Be,this.currentFuel=null,this.currentStage=(e=(n=(i=this.router.getCurrentNavigation())==null?void 0:i.extras)==null?void 0:n.state)==null?void 0:e.stage,this.title=this.currentStage=="checkin"?" Checkin":" Checkout",oe(()=>{this.currentStage=="checkin"?this.contracts=this.contractsService.contracts().filter(a=>{var s;return((s=a.inspection)==null?void 0:s.idEstado)==48}):this.contracts=this.contractsService.contracts().filter(a=>a.inspection==null)})}ngOnDestroy(){this.currentInspection.set(void 0)}selectContract(i){var e,a,s;let n;if(this.currentStage=="checkin"){let h=((e=this.inspectionsServices.inspections())==null?void 0:e.filter(_=>_.idEstado==48)).find(_=>_.idVehiculo==i.value.idVehiculo);n=(a=this.contractsService.contracts())==null?void 0:a.find(_=>_.idContrato==(h==null?void 0:h.idContrato)),this.contractsService.setCurrentContract(n),this.initializeCheckin(h)}else n=(s=this.contractsService.contracts())==null?void 0:s.find(p=>p.idContrato==i.value.idContrato),this.contractsService.setCurrentContract(n),this.initializeCheckout()}selectCar(i){var e,a,s;let n=(e=this.carsService.cars())==null?void 0:e.find(p=>p.idVehiculo==i.value.idVehiculo);this.carsService.currentCar.set(n),((a=this.currentInspection())==null?void 0:a.stage)=="checkin"?this.selectContract(i):((s=this.currentInspection())==null?void 0:s.stage)=="checkout"&&this.inspectionsServices.currentInspection.update(p=>{let h=S({},p);return h.idVehiculo=this.carsService.currentCar().idVehiculo,h.odoSalida=this.carsService.currentCar().odometro,h.combSalida=void 0,h}),this.currentFuel=null}initializeCheckin(i){this.currentFuel=null,this.inspectionsServices.currentInspection.set(i),this.inspectionsServices.currentInspection.update(n=>{let e=S({},n);return e.stage=this.currentStage,e.odoEntrega=void 0,e.combEntrega=void 0,e.accesoriosEntrega=[],e}),this.contractsService.currentContract.update(n=>{var a;let e=S({},n);return e.car&&(e.car.odometro=(a=this.currentInspection())==null?void 0:a.odoSalida),e})}initializeCheckout(){var i;this.currentFuel=(i=this.currentContract().check_out_fuel)==null?void 0:i.idTanqueComb,this.inspectionsServices.currentInspection.update(n=>{var a,s;let e=S({},n);return e.stage=this.currentStage,e.idVehiculo=this.contractsService.currentContract().idVehiculo,e.idContrato=this.contractsService.currentContract().idContrato,e.idCliente=this.contractsService.currentContract().idCliente,e.idAgenciaSalida=this.contractsService.currentContract().idAgenciaSalida,e.fechaSalida=this.contractsService.currentContract().fechaSalida,e.odoSalida=(a=this.contractsService.currentContract().car)==null?void 0:a.odometro,e.nomRecibeVehiculo=(s=this.contractsService.currentContract().customer)==null?void 0:s.nomCliente,e.accesoriosSalida=[],e.photos=[],e.combSalida=this.currentFuel,e}),this.carsService.currentCar.set(this.currentContract().car)}goToNext(){var p,h,_,d,W,B,G,K,U,H,J,Q,X;let i,n,e,a,s;if(((p=this.currentInspection())==null?void 0:p.stage)=="checkin"?(i=((h=this.currentInspection())==null?void 0:h.idVehiculo)!=null,n=((_=this.currentInspection())==null?void 0:_.combEntrega)!=null,e=((d=this.currentInspection())==null?void 0:d.odoEntrega)!=null,a=((W=this.currentInspection())==null?void 0:W.odoEntrega)>((B=this.currentInspection())==null?void 0:B.odoSalida),s=(G=this.currentInspection())==null?void 0:G.odoSalida):(i=((K=this.currentInspection())==null?void 0:K.idVehiculo)!=null,n=((U=this.currentInspection())==null?void 0:U.combSalida)!=null&&((H=this.currentInspection())==null?void 0:H.combSalida)!=null,e=((J=this.currentInspection())==null?void 0:J.odoSalida)!=null&&((Q=this.currentInspection())==null?void 0:Q.odoSalida)!=null,a=((X=this.currentInspection())==null?void 0:X.odoSalida)<=this.carsService.currentCar().odometro+1e3,s=this.carsService.currentCar().odometro),i&&n&&e&&a)this.navCtlr.navigateForward(["/inspections/create/photos"],{state:{customer:this.currentContract().customer,driver:this.currentContract().driver}});else{let Ze=i?a?"No ha completado la informaci\xF3n":`El Kilometraje ingresado no es v\xE1lido. El valor de referencia es ${s}`:"No ha seleccionado un veh\xEDculo";this.alertsService.basicAlert("Atenci\xF3n!",Ze,["Ok"])}}setOdometer(i){this.inspectionsServices.currentInspection.update(n=>{let e=S({},n);return e.stage=="checkin"?e.odoEntrega=parseInt(i.target.value):e.odoSalida=parseInt(i.target.value),e})}setFuel(i){this.inspectionsServices.currentInspection.update(n=>{let e=S({},n);return e.stage=="checkin"?e.combEntrega=i.target.value.toString().trim():e.combSalida=i.target.value.toString().trim(),e})}addDocument(){this.photoService.addNewToGallery().then(()=>{this.inspectionsServices.currentInspection.update(i=>{let n=S({},i);return n.fotoLicencia=this.photoService.photos()[0],n}),this.photoService.clearPhotos()})}removeDocument(){this.inspectionsServices.currentInspection.update(i=>{let n=S({},i);return n.fotoLicencia=void 0,n})}};o.\u0275fac=function(n){return new(n||o)},o.\u0275cmp=Y({type:o,selectors:[["app-inspection-create"]],decls:18,vars:5,consts:[[3,"fullscreen"],["fixed",""],["size","12"],[1,"ion-align-items-center"],["vertical","bottom","horizontal","start","slot","fixed"],["slot","end"],[3,"click"],["slot","end","name","arrow-forward"],[2,"border-radius","10px"],["lines","none"],["color","secondary","slot","start",2,"color","var(--ion-color-secondary)",3,"icon"],["color","secondary","itemValueField","idContrato","itemTextField","numContrato",1,"ion-margin-start",3,"onChange","ngModel","items","canSearch"],["color","secondary","name","crescent"],["color","secondary","slot","start","name","car"],["color","secondary","itemValueField","idVehiculo","itemTextField","nemVehiculo",1,"ion-margin-start",3,"onChange","ngModel","items","canSearch"],["color","secondary","labelPlacement","stacked","label","Nombre del Cliente","type","text","readonly","",3,"value"],["color","secondary","labelPlacement","stacked","label","Conductor Adicional","type","text","readonly","",3,"value"],["color","secondary","labelPlacement","stacked","label","Marca y Modelo del Veh\xEDculo | Placa","type","text","placeholder","Marca y Modelo del Veh\xEDculo | Placa","readonly","",3,"value"],["color","secondary","labelPlacement","stacked","label","Color","type","text","placeholder","Color","readonly","",3,"value"],["size","6"],["position","stacked",2,"--color","var(--ion-color-secondary)"],["required","","type","number","errorText","Valor no v\xE1lido","aria-label","Kilometraje",3,"ionChange","value","min","max"],["required","","type","text","errorText","Este campo es obligatorio","aria-label","Nivel de Combustible",3,"ngModelChange","ionChange","ngModel","label"],[3,"value"],["button","","color","danger","name","close-circle","slot","end",3,"click"],["title","Licencia","text","Preview","scheme","light",3,"src"],["name","document-attach"]],template:function(n,e){if(n&1&&(f(0,"app-toolbar"),l(1,"ion-content",0)(2,"ion-grid",1)(3,"ion-row")(4,"ion-col",2)(5,"ion-title"),m(6),r()()(),E(7,lt,24,2)(8,pt,12,1)(9,ht,4,0,"ion-row",3)(10,ft,32,12),r(),E(11,gt,3,0,"ion-fab",4),r(),l(12,"ion-footer")(13,"ion-toolbar")(14,"ion-buttons",5)(15,"ion-button",6),b("click",function(){return e.goToNext()}),m(16," Siguiente "),f(17,"ion-icon",7),r()()()()),n&2){let a,s,p;u(),g("fullscreen",!0),u(5),j("Nueva Inspecci\xF3n de ",e.currentStage==="checkout"?"Salida":"Entrada"," "),u(),k(7,((a=e.currentInspection())==null?null:a.stage)==="checkout"?7:((a=e.currentInspection())==null?null:a.stage)=="checkin"?8:-1),u(2),k(9,((s=e.currentInspection())==null?null:s.idVehiculo)===void 0?9:10),u(2),k(11,((p=e.currentInspection())==null?null:p.idVehiculo)!==void 0&&e.currentStage==="checkout"?11:-1)}},dependencies:[he,_e,Ce,fe,ge,Se,ve,Ie,xe,be,Ee,Te,R,Ve,ke,ye,we,Pe,De,Fe,Me,Ne,Ae,de,me,pe,N,ae,A,L,Ge]});let t=o;return t})();var St=[{path:"",component:Xe,canActivate:[V]},{path:"photos",loadComponent:()=>import("./chunk-QISHHENM.js").then(t=>t.PhotosComponent),canActivate:[V,w]},{path:"accessories",loadComponent:()=>import("./chunk-FIWG5E3O.js").then(t=>t.AccessoriesComponent),canActivate:[V,w]},{path:"notes",loadComponent:()=>import("./chunk-DH3FUEB5.js").then(t=>t.AdditionalNotesComponent),canActivate:[V,w]},{path:"signing",loadComponent:()=>import("./chunk-65L6WFD2.js").then(t=>t.SigningComponent),canActivate:[V,w]}],Ye=(()=>{let o=class o{};o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=D({type:o}),o.\u0275inj=P({imports:[q.forChild(St),q]});let t=o;return t})();var en=(()=>{let o=class o{};o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=D({type:o}),o.\u0275inj=P({imports:[Le,re,Ye,se,le,y,L,We,Ke]});let t=o;return t})();export{en as InspectionCreatePageModule};
